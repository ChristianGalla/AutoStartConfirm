<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
	<Package Name="Auto Start Confirm" Language="1033" Version="!(bind.FileVersion.MainExecutable)" Manufacturer="Christian Galla" UpgradeCode="9795b8c4-0f77-4094-a3e4-43a914b674c2"><SummaryInformation Description="Auto Start Confirm Installer" Manufacturer="Christian Galla" />

		<WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
		<MediaTemplate EmbedCab="yes" />

		<Feature Id="Complete" Title="Auto Start Confirm" Description="The complete package." Level="1" Display="expand" ConfigurableDirectory="APPLICATIONFOLDER">
			<Feature Id="MainProgram" Title="Program" Description="The main executable. Required." Level="1" AllowAbsent="no">
				<ComponentGroupRef Id="ProductComponents" />
				<!-- ($var.ProjectName)_Project is the list of all files generated by dotnet publish. It's in ($var.ProjectName).wxs, 
			     which is in turn generated as a BeforeBuild target and can be found in the main WiX project file, WiX Setup.wixproj.
				 The standalone does not require the .NET Core 3.1 runtime to be installed -->
				<ComponentGroupRef Id="$(var.ProjectName)_Project" />
				<ComponentRef Id="ApplicationDesktopShortcut" />
				<ComponentRef Id="ApplicationStartMenuShortcut" />
			</Feature>
		</Feature>

		<Icon Id="icon.ico" SourceFile="..\$(var.ProjectName)\Assets\Icon.ico" />
		<Property Id="ARPPRODUCTICON" Value="icon.ico" />

		<Property Id="WIXUI_INSTALLDIR" Value="APPLICATIONFOLDER" />

		<Property Id="INSTALLSHORTCUT" Secure="yes" />

		<Property Id="START_AFTER_INSTALL" Value="1" />

		



		<UIRef Id="CustomUI" />
		<UIRef Id="WixUI_Common" />

		<Property Id="WixShellExecTarget" Value="[#MainExecutable]" />
		<CustomAction Id="LaunchApplication" DllEntry="WixShellExec" Impersonate="yes" BinaryRef="Wix4UtilCA_X86" />
	
			<StandardDirectory Id="ProgramFiles64Folder">
				<Directory Id="APPLICATIONFOLDER" Name="Auto Start Confirm">
					<Directory Id="ASSETS" Name="Assets" />
				</Directory>
			</StandardDirectory>
			<StandardDirectory Id="ProgramMenuFolder">
				<Directory Id="ApplicationProgramsFolder" Name="Auto Start Confirm" />
			</StandardDirectory>
			<StandardDirectory Id="DesktopFolder" />
		</Package>

	<Fragment>
		<ComponentGroup Id="ProductComponents" Directory="APPLICATIONFOLDER">
			<Component Id="MainExecutable" Guid="{5DA0A1A5-9166-4DF6-9AEB-B527376A62D3}">
				<File Id="MainExecutable" Source="$(var.BasePath)\$(var.ProjectName).exe" KeyPath="yes" />
			</Component>
			<Component Id="nlog.config" Guid="{4095BCD0-581B-43C6-80AC-7EFCB2E62788}">
				<File Id="nlog.config" Source="$(var.BasePath)\nlog.sample.config" Name="nlog.config" />
			</Component>
		</ComponentGroup>
		
		<DirectoryRef Id="ApplicationProgramsFolder">
			<Component Id="ApplicationStartMenuShortcut" Guid="{CB1D72D9-27EF-4798-AE69-4FDC6BCCECBD}">
				<Shortcut Id="ApplicationStartMenuShortcut" Name="Auto Start Confirm" Target="[#MainExecutable]" WorkingDirectory="APPLICATIONFOLDER">
					<!--AUMID-->
					<ShortcutProperty Key="System.AppUserModel.ID" Value="ChristianGalla.AutoStartConfirm" />
					<!--COM CLSID-->
					<ShortcutProperty Key="System.AppUserModel.ToastActivatorCLSID" Value="{DF651CDF-EC4A-4C98-9419-DE2709B00863}" />
				</Shortcut>
				<RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall" />
				<RegistryValue Root="HKCU" Key="Software\Christian Galla\Auto Start Confirm" Name="StartMenuShortcutInstalled" Type="integer" Value="1" KeyPath="yes" />
			</Component>
		</DirectoryRef>

		<StandardDirectory Id="DesktopFolder">
			<Component Id="ApplicationDesktopShortcut" Guid="{84E64D2C-AC8D-4B67-9DA0-8E3E2EFCE352}" Condition="INSTALLSHORTCUT">
				
				<Shortcut Id="ApplicationDesktopShortcut" Name="Auto Start Confirm" Target="[#MainExecutable]" WorkingDirectory="APPLICATIONFOLDER">
					<!--AUMID-->
					<ShortcutProperty Key="System.AppUserModel.ID" Value="ChristianGalla.AutoStartConfirm" />
					<!--COM CLSID-->
					<ShortcutProperty Key="System.AppUserModel.ToastActivatorCLSID" Value="{DF651CDF-EC4A-4C98-9419-DE2709B00863}" />
				</Shortcut>
				<RegistryValue Root="HKCU" Key="Software\Christian Galla\Auto Start Confirm" Name="DesktopShortcutInstalled" Type="integer" Value="1" KeyPath="yes" />
			</Component>
		</StandardDirectory>
	</Fragment>

	<?foreach WIXUIARCH in X64 ?>
	<Fragment>
		<UI Id="CustomUI">
			<TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
			<TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
			<TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

			<Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
			<Property Id="WixUI_Mode" Value="InstallDir" />

			<DialogRef Id="BrowseDlg" />
			<DialogRef Id="DiskCostDlg" />
			<DialogRef Id="ErrorDlg" />
			<DialogRef Id="FatalError" />
			<DialogRef Id="FilesInUse" />
			<DialogRef Id="MsiRMFilesInUse" />
			<DialogRef Id="PrepareDlg" />
			<DialogRef Id="ProgressDlg" />
			<DialogRef Id="ResumeDlg" />
			<DialogRef Id="UserExit" />

			<Publish Dialog="BrowseDlg" Control="OK" Event="DoAction" Value="WixUIValidatePath_$(sys.BUILDARCHSHORT)" Order="3" />
			<Publish Dialog="BrowseDlg" Control="OK" Event="SpawnDialog" Value="InvalidDirDlg" Order="4" Condition="NOT WIXUI_DONTVALIDATEPATH AND WIXUI_INSTALLDIR_VALID&lt;&gt;&quot;1&quot;" />

			<Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999" />
			<Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" Value="LaunchApplication" Condition="START_AFTER_INSTALL = 1" />

			<Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg" Condition="NOT Installed" />
			<Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" Condition="Installed AND PATCH" />

			<Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" />
			<Publish Dialog="LicenseAgreementDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg" Condition="LicenseAccepted = &quot;1&quot;" />
			<Publish Dialog="LicenseAgreementDlg" Control="Print" Event="DoAction" Value="WixUIPrintEula_$(WIXUIARCH)" />

			<Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="LicenseAgreementDlg" />
			<Publish Dialog="InstallDirDlg" Control="Next" Event="SetTargetPath" Value="[WIXUI_INSTALLDIR]" Order="1" />
			<Publish Dialog="InstallDirDlg" Control="Next" Event="DoAction" Value="WixUIValidatePath_$(sys.BUILDARCHSHORT)" Order="2" Condition="NOT WIXUI_DONTVALIDATEPATH" />
			<Publish Dialog="InstallDirDlg" Control="Next" Event="SpawnDialog" Value="InvalidDirDlg" Order="3" Condition="NOT WIXUI_DONTVALIDATEPATH AND WIXUI_INSTALLDIR_VALID&lt;&gt;&quot;1&quot;" />
			<Publish Dialog="InstallDirDlg" Control="Next" Event="NewDialog" Value="AdditionalSettingsDlg" Order="4" Condition="WIXUI_DONTVALIDATEPATH OR WIXUI_INSTALLDIR_VALID=&quot;1&quot;" />
			<Publish Dialog="InstallDirDlg" Control="ChangeFolder" Property="_BrowseProperty" Value="[WIXUI_INSTALLDIR]" Order="1" />
			<Publish Dialog="InstallDirDlg" Control="ChangeFolder" Event="SpawnDialog" Value="BrowseDlg" Order="2" />

			<Publish Dialog="AdditionalSettingsDlg" Control="Back" Event="NewDialog" Value="InstallDirDlg" />
			<Publish Dialog="AdditionalSettingsDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" />

			<Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="AdditionalSettingsDlg" Order="1" Condition="NOT Installed" />
			<Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg" Order="2" Condition="Installed AND NOT PATCH" />
			<Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2" Condition="Installed AND PATCH" />

			<Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg" />

			<Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg" />
			<Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg" />
			<Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg" />

			<Property Id="ARPNOMODIFY" Value="1" />
		</UI>

		<UI>
			<Dialog Id="AdditionalSettingsDlg" Width="370" Height="270" Title="[ProductName] Setup">

				<Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="WixUI_Bmp_Banner" />
				<Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
				<Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />
				<Control Id="Description" Type="Text" X="25" Y="23" Width="280" Height="15" Transparent="yes" NoPrefix="yes" Text="Configure additional settings." />
				<Control Id="Title" Type="Text" X="15" Y="6" Width="210" Height="15" Transparent="yes" NoPrefix="yes" Text="{\WixUI_Font_Title}Additional settings" />

				<Control Id="InstallShortcutCheckbox" Type="CheckBox" X="20" Y="65" Width="300" Height="17" Property="INSTALLSHORTCUT" CheckBoxValue="1" Text="Create desktop shortcut for all users" />
				<Control Id="StartAfterInstallCheckbox" Type="CheckBox" X="20" Y="85" Width="300" Height="17" Property="START_AFTER_INSTALL" CheckBoxValue="1" Text="Start Auto Start Confirm after installation (to System Tray)" />
				<Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" />
				<Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
				<Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
					<Publish Event="SpawnDialog" Value="CancelDlg" />
				</Control>


			</Dialog>
		</UI>

	</Fragment>
	<?endforeach?>

</Wix>
